<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="./user.css" />

    <title>Movie_Playlist_App</title>
  </head>

  <body>
    <header>
      <h1>Enjoy Your Playlist<span style="font-size: 20px">&#129505;</span></h1>

      <div class="user-profile">
        <section class="movie-search">
          <div id="input">
            <input
              type="text"
              id="search-input"
              placeholder="Enter movie title"
            />
          </div>
          <div><button id="searchbtn">Search</button></div>

          <div id="search-results"></div>
        </section>
        <!-- <span id="username">Guest</span> -->
        <button id="create_playlsit">playlsit</button>
        <button id="home">home</button>
        <button id="movie">movie</button>
        <div id="popupForm">
          <form class="popup" id="popup" onsubmit="onAdd()">
            <!-- Your form fields here -->

            <h1>Your own playlsit</h1>

            <input type="text" id="title" placeholder=" Title" />

            <input type="text" id="desc" placeholder=" Description" />

            <select name="section" id="private">
              <option value="private" id="is_private">private</option>
              <option value="public" id="public">public</option>
            </select>
            <input
              type="submit"
              id="createplaylistbt"
              value="Create Playlsit"
            />
          </form>
        </div>
      </div>
    </header>
    <main>
      <div id="cont">
        <h1>Playlist</h1>
      </div>
    </main>

    <hr />
    <div class="footer">
      <ul class="foot">
        <li>Google Play</li>
        <li>Play Pass</li>
        <li>Play Points</li>
        <li>Gift cards</li>
        <li>Redeem</li>
        <li>Refund policy</li>
        <li>Kids & family</li>
        <li>Parent Guide</li>
      </ul>
      <ul class="foot">
        <li>Family sharing</li>
        <li>Terms of Service</li>
        <li>About Google Play</li>
        <li>Developers</li>
        <li>Redeem</li>
      </ul>
      <ul class="foot">
        <li>Google Play</li>
        <li>Play Pass</li>
      </ul>

      <div class="bottom">
        <span>facebook</span>
        <span>Instagram</span>
        <span>twitter</span>
      </div>
    </div>
  </body>
</html>
<script>
  let homepage = document.getElementById("home");

  homepage.addEventListener("click", (req, res) => {
    window.location.href = "./index.html";
  });

  let movie = document.getElementById("movie");

  movie.addEventListener("click", (req, res) => {
    window.location.href = "./moviepage.html";
  });
  movie;
  let createplaylist = document.getElementById("create_playlsit");
  const currUser = JSON.parse(localStorage.getItem("user"));

  const popupForm = document.getElementById("popupForm");

  createplaylist.addEventListener("click", () => {
    popupForm.style.display = "block"; // Show the popup
  });

  popupForm.addEventListener("submit", (event) => {
    event.preventDefault(); // Prevent form submission

    // Handle form submission here

    popupForm.style.display = "none"; // Hide the popup after submission
  });

 
  const addPlaylistForm = document.getElementById("popup");
  let cont = document.getElementById("cont");

  const onAdd = () => {
    const payload = {
      userid: currUser._id,
      title: addPlaylistForm[0].value,
      desc: addPlaylistForm[1].value,
      isprivate: addPlaylistForm[2].value,
    };

    console.log(payload);

    fetch("http://localhost:3000/play/create", {
      method: "POST",
      headers: {
        "Content-type": "application/json",
        Authorization: localStorage.getItem("token"),
      },
      body: JSON.stringify(payload),
    })
      .then((res) => res.json())
      .then((res) => {
        console.log(res);
        fetchAndRender(currUser._id);
      })
      .catch((err) => {
        console.log(err);
      });
  };

  const fetchAndRender = (uid) => {
    fetch(`http://localhost:3000/play/playlist/${uid}`, {
      method: "GET",
      headers: {
        "Content-type": "application/json",
        Authorization: localStorage.getItem("token"),
      },
    })
      .then((res) => res.json())
      .then((res) => {
        console.log(res);
      })
      .catch((err) => {
        console.log(err);
      });
  };

  function display(data) {
    cont.innerHTML = "";

    data.forEach((el) => {
      const list = document.createElement("div");
      list.style.cssText = "border: 1px solid red; width: 20%; height: 20%;";

      const card = document.createElement("div");
      const title = document.createElement("p");
      title.textContent = el.title;

      const btncount = document.createElement("p");
      btncount.textContent = el.isprivate ? "Private" : "Public";

      const btnprivate = document.createElement("p");
      btnprivate.textContent = `${el.playList.length} tracks`;

      card.addEventListener("click", () => {
        fetchAndRender(el._id);
      });

      card.append(title, btncount, btnprivate);

      const dec = document.createElement("p");
      dec.textContent = el.desc;

      dec.addEventListener("click", () => {
        fetchAndRender(el._id);
      });

      list.append(card, dec);
      console.log(list)
      cont.append(list);
    });
  }

  window.addEventListener("load", () => {
    fetchAndRender(currUser._id);
  });

</script>
